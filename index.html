<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Waterjet Run Tracker Connector</title>
  </head>
  <body>
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script>
      /* global TrelloPowerUp */
      TrelloPowerUp.initialize({
        "on-enable": function () {
          return Promise.resolve();
        },

        "authorization-status": function (t) {
          return t.getRestApi().isAuthorized().then(function (authorized) {
            return { authorized: authorized };
          });
        },

        "show-authorization": function (t) {
          // Prefer RestApi authorize (more reliable in Power-Up iframes),
          // fall back to t.authorize if needed.
          var opts = {
            scope: { read: true, write: false },
            expiration: "never",
            name: "Waterjet Run Tracker"
          };

          try {
            var rest = t.getRestApi && t.getRestApi();
            if (rest && rest.authorize) {
              return rest.authorize(opts);
            }
          } catch (e) {
            // ignore
          }

          return t.authorize(opts);
        },

        "card-buttons": function (t) {
          return [{
            icon: "https://cdn-icons-png.flaticon.com/512/3063/3063822.png",
            text: "Add Run Tracker",
            callback: function (t) {
              return t.modal({
                title: "Create Run Tracker",
                url: t.signUrl("./create.html"),
                fullscreen: false,
                height: 700
              });
            }
          }];
        },

        "card-back-section": function (t) {
          return {
            title: "Waterjet Run Tracker",
            icon: "https://cdn-icons-png.flaticon.com/512/3063/3063822.png",
            content: {
              type: "iframe",
              url: t.signUrl("./tracker.html"),
              height: 620
            }
          };
        }
      });
    </script>
  </body>
</html>
